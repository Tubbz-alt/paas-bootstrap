---
releases:
- name: datadog-agent
  version: 0.1.5
  url: https://s3-eu-west-1.amazonaws.com/gds-paas-build-releases/datadog-agent-0.1.5.tgz
  sha1: 573bed2ab7960eb97dafff4b7c6111e7ad72b39c

meta:

jobs:
- name: bosh
  templates:
  - {name: datadog-agent, release: datadog-agent}
  properties:
    enabled: (( grab $ENABLE_DATADOG ))
    api_key: (( grab $DATADOG_API_KEY || "undefined" ))
    application_key: (( grab $DATADOG_APP_KEY || "undefined" ))
    use_dogstatsd: false
    include_bosh_tags: true
    tags:
      aws_account: (( grab $AWS_ACCOUNT ))
      deploy_env: (( grab terraform_outputs.environment ))
    integrations:
      process:
        init_config:
        instances:
          - name: btrfs
            search_string: ["btrfs"]
    tags:
      bosh-job: bosh
      bosh-az: (( grab terraform_outputs.bosh_az_label ))
    hm:
      datadog_enabled: (( grab meta.datadog.enabled ))
      datadog:
          api_key: (( grab meta.datadog.api_key ))
          application_key: (( grab meta.datadog.application_key ))
